#!/bin/bash

supp_dir="$HOME/.bash_extras"
supp_files=(exports functions aliases completions secrets local_settings)

load_extras() {
    if [[ -z "$1" ]]; then
        echo "cannot source nothing, something went wrong in bashrc"
    else
        for supp_file in "$supp_dir/$1"*; do
            # shellcheck disable=SC1090
            [[ -f $supp_file ]] && source "$supp_file"
        done
    fi
}

# append to the history file, don't overwrite it
shopt -s histappend
shopt -s globstar

# load exports first
load_extras "${supp_files[0]}"

# set up conda, if present
for CONDA_DIR in $HOME/{,.}miniconda3; do
    if [[ -d "$CONDA_DIR" ]]; then
        # shellcheck disable=SC1091
        source "$CONDA_DIR/etc/profile.d/conda.sh"
        conda activate "${DEFAULT_CONDA_ENV:-base}"
    fi
done
unset CONDA_DIR

# load the rest
for supp_type in "${supp_files[@]:1}"; do
    load_extras "$supp_type"
done

# shellcheck disable=SC1091
[[ -f $HOME/liquidprompt/liquidprompt && $- = *i* ]] && source "$HOME/liquidprompt/liquidprompt"
